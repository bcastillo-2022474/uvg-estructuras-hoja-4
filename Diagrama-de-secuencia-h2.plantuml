@startuml
title Diagrama de Secuencia - Evaluación Infix "(10+20)*9"

actor Usuario
participant ":Main" as Main
participant ":StackFactory" as SF
participant ":ListFactory" as LF
participant ":InfixParser" as IP
participant ":Parser" as Parser
participant ":Calculator" as Calc
participant ":Stack<Token>" as Stack

Usuario -> Main: main(args)
activate Main

Main -> Usuario: Mostrar menú de pila\n(1:ArrayList, 2:Array, 3:Lista)
Usuario -> Main: Selección (ej. 3)

opt stackType == 3
    Main -> Usuario: Mostrar menú de lista\n(1:Simplemente, 2:Doblemente)
    Usuario -> Main: Selección (ej. 1)
end

Main -> Main: processFile("datos.txt")
Main -> Main: readFile("datos.txt")

loop cada línea del archivo

    Main -> Main: operate("(10+20)*9")

    == Fase 1: Infix → Postfix ==
    Main -> IP: new InfixParser()
    activate IP
    Main -> IP: toPostfix("(10+20)*9")
    IP --> Main: "10 20 + 9 *"
    deactivate IP

    == Fase 2: Tokenización ==
    Main -> Parser: new Parser()
    activate Parser
    Main -> Parser: parse("10 20 + 9 *")
    Parser --> Main: [OPERAND:10, OPERAND:20, OPERATOR:+, OPERAND:9, OPERATOR:*]
    deactivate Parser

    == Fase 3: Crear pila (Factory) ==
    Main -> SF: createStack(stackType, listType)
    activate SF
    opt stackType == 3
        SF -> LF: createList(listType)
        activate LF
        LF --> SF: LinkedList / DoubleLinkedList
        deactivate LF
    end
    SF --> Main: Stack<Token>
    deactivate SF

    == Fase 4: Evaluación (Singleton) ==
    Main -> Calc: getInstance()
    activate Calc
    Main -> Calc: operate(tokens, stack)

    Calc -> Stack: push(OPERAND:10)
    Calc -> Stack: push(OPERAND:20)
    Calc -> Stack: pop()
    Stack --> Calc: OPERAND:20
    Calc -> Stack: pop()
    Stack --> Calc: OPERAND:10
    Calc -> Calc: 10 + 20 = 30
    Calc -> Stack: push(OPERAND:30)

    Calc -> Stack: push(OPERAND:9)
    Calc -> Stack: pop()
    Stack --> Calc: OPERAND:9
    Calc -> Stack: pop()
    Stack --> Calc: OPERAND:30
    Calc -> Calc: 30 * 9 = 270
    Calc -> Stack: push(OPERAND:270)

    Calc -> Stack: pop()
    Stack --> Calc: OPERAND:270
    Calc --> Main: 270.0
    deactivate Calc

    Main --> Usuario: "Línea 1: (10+20)*9 = 270.0"

end

deactivate Main

@enduml
